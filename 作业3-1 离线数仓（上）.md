

# 一、最近七天连续三天活跃会员数

```sql
with tmp as (
    select device_id, dt, date_sub(dt, row_number() over (partition by device_id order by dt)) gid
    from dws.dws_member_start_day
    where dt between date_sub(current_date, -7) and current_date
)
select count(distinct device_id) total
from (
         select device_id, count(1) cnt
         from tmp
         group by device_id, gid
         having cnt >= 3
     ) distinct_device_ids;
```

# 二、项目的数据采集过程中，有哪些地方能够优化？

1. 数据采集中通过拦截器清洗数据，只保留Json字符串，去除掉无效的日志。
2. 使用kafka channel 代替memory channel，保证数据不丢失。

